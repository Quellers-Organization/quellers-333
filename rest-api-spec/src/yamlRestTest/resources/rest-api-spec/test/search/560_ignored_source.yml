---
setup:
  - skip:
      features: headers
  - do:
      indices.create:
        index: test
        body:
          mappings:
            _source:
              mode: synthetic
            properties:
              object:
                enabled: false

  - do:
      headers:
        Content-Type: application/yaml
      index:
        index: test
        id: "1"
        refresh: true
        body:
          object:
            name: "foo"
            value: 10

---
001_fetch_stored_fields_wildcard:

  - do:
      search:
        index: test
        body:
          stored_fields: [ "*" ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: null }

---
002_fetch_fields_wildcard:

  - do:
      search:
        index: test
        body:
          fields: [ "*" ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: null }

---
003_fetch_stored_fields_by_name:

  - do:
      search:
        index: test
        body:
          stored_fields: [ _ignored_source ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: "BgAAAG9iamVjdHktLS0KbmFtZTogImZvbyIKdmFsdWU6IDEwCg" }

---
004_fetch_fields_by_name:

  - do:
      search:
        index: test
        body:
          fields: [ _ignored_source ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: "BgAAAG9iamVjdHktLS0KbmFtZTogImZvbyIKdmFsdWU6IDEwCg" }

---
005_fields_and_stored_fields_combination:

  - do:
      search:
        index: test
        body:
          stored_fields: [ object ]
          fields: [ object ]
          query:
            match_all: {}

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0.fields.object: null }
  - match: { hits.hits.0._ignored_source: null }

---
006_wildcard_fields_and_stored_fields_combination:

  - do:
      search:
        index: test
        body:
          stored_fields: [ "*" ]
          fields: [ "*" ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: null }

---
007_fields_with_ignored_source_combination:

  - do:
      search:
        index: test
        body:
          stored_fields: [ _ignored_source ]
          fields: [ object ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: "BgAAAG9iamVjdHktLS0KbmFtZTogImZvbyIKdmFsdWU6IDEwCg" }
  - match: { hits.hits.0.fields: null }

---
008_ignored_source_via_fields_and_wildcard_stored_fields:

  - do:
      search:
        index: test
        body:
          stored_fields: [ "*" ]
          fields: [ _ignored_source, object ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: "BgAAAG9iamVjdHktLS0KbmFtZTogImZvbyIKdmFsdWU6IDEwCg" }

---
009_wildcard_fields_and_ignored_source_via_stored_fields:

  - do:
      search:
        index: test
        body:
          stored_fields: [ _ignored_source ]
          fields: [ "*" ]

  - match: { hits.total.value: 1 }
  - match: { hits.hits.0._ignored_source: "BgAAAG9iamVjdHktLS0KbmFtZTogImZvbyIKdmFsdWU6IDEwCg" }
