---
setup:
  - requires:
      test_runner_features: [capabilities]
      capabilities:
        - method: PUT
          path: /{index}
          capabilities: [logs_index_mode]
      reason: "Support for 'logs' index mode capability required"

---
stored _source mode is not supported:
  - requires:
      test_runner_features: [capabilities]
      capabilities:
        - method: PUT
          path: /{index}
          capabilities: [logs_index_mode]
      reason: "Support for 'logs' index mode capability required"

  - do:
      catch: bad_request
      indices.create:
        index: test-stored-source
        body:
          settings:
            index:
              mode: logs
          mappings:
            _source:
              mode: stored

  - match: { error.type: "mapper_parsing_exception" }
  - match: { error.root_cause.0.type: "mapper_parsing_exception" }
  - match: { error.reason: "Failed to parse mapping: Indices with with index mode [logs] only support synthetic source" }

---
disabled _source is not supported:
  - requires:
      test_runner_features: [capabilities]
      capabilities:
        - method: PUT
          path: /{index}
          capabilities: [logs_index_mode]
      reason: "Support for 'logs' index mode capability required"

  - do:
      catch: bad_request
      indices.create:
        index: test-disabled-source
        body:
          settings:
            index:
              mode: logs
          mappings:
            _source:
              enabled: false

  - match: { error.type: "mapper_parsing_exception" }
  - match: { error.root_cause.0.type: "mapper_parsing_exception" }
  - match: { error.reason: "Failed to parse mapping: Indices with with index mode [logs] only support synthetic source" }

  - do:
      catch: bad_request
      indices.create:
        index: test-disabled-source
        body:
          settings:
            index:
              mode: logs
          mappings:
            _source:
              mode: disabled

  - match: { error.type: "mapper_parsing_exception" }
  - match: { error.root_cause.0.type: "mapper_parsing_exception" }
  - match: { error.reason: "Failed to parse mapping: Indices with with index mode [logs] only support synthetic source" }
