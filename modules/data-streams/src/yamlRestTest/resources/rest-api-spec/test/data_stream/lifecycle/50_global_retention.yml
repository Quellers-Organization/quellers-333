setup:
  - requires:
      reason: "Global retention was exposed in 8.16+"
      test_runner_features: [ capabilities, allowed_warnings ]
      capabilities:
        - method: GET
          path: /_data_stream/{index}/_lifecycle
          capabilities: [ 'data_stream_global_retention' ]
  - do:
      allowed_warnings:
        - "index template [my-template] has index patterns [my-data-stream] matching patterns from existing older templates [global] with patterns (global => [*]); this template [my-template] will take precedence during new index creation"
      indices.put_index_template:
        name: my-template
        body:
          index_patterns: [my-data-stream]
          template:
            settings:
              index.number_of_replicas: 1
          data_stream: {}
---
teardown:
  - do:
      cluster.put_settings:
        body:
          persistent:
            data_streams.lifecycle.retention.max: null
            data_streams.lifecycle.retention.default: null

---
"Get data stream api check the exposure of global retention":
  - do:
      indices.get_data_lifecycle:
        name: "*"
  - is_false: global_retention

  - do:
      cluster.put_settings:
        body:
          persistent:
            data_streams.lifecycle.retention.default: "7d"
            data_streams.lifecycle.retention.max: "90d"

  - do:
      indices.get_data_lifecycle:
        name: "*"
  - match: { global_retention.default_retention: "7d" }
  - match: { global_retention.max_retention: "90d" }
