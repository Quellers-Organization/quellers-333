---
version: ${xpack.oteldata.template.version}
_meta:
  description: Aliases from OpenTelemetry SemConv fields to ECS (and some non-ECS) fields
  managed: true
template:
  mappings:
    properties:
      resource:
        properties:
          attributes:
            type: passthrough
            dynamic: true
            priority: 30
            time_series_dimension: true
            properties:
              telemetry.sdk.language:
                type: keyword
                ignore_above: 1024
              service.instance.id:
                type: keyword
                ignore_above: 1024
              deployment.environment:
                type: keyword
                ignore_above: 1024
              cloud.platform:
                type: keyword
                ignore_above: 1024
              container.image.tags:
                type: keyword
                ignore_above: 1024
              host.arch:
                type: keyword
                ignore_above: 1024
              process.executable.path:
                type: keyword
                ignore_above: 1024
              process.runtime.path:
                type: keyword
                ignore_above: 1024
              process.runtime.version:
                type: keyword
                ignore_above: 1024
              os.name:
                type: keyword
                ignore_above: 1024
              os.type:
                type: keyword
                ignore_above: 1024
              os.description:
                type: keyword
                ignore_above: 1024
              os.version:
                type: keyword
                ignore_above: 1024
              k8s.deployment.name:
                type: keyword
                ignore_above: 1024
              k8s.namespace.name:
                type: keyword
                ignore_above: 1024
              k8s.node.name:
                type: keyword
                ignore_above: 1024
              k8s.pod.name:
                type: keyword
                ignore_above: 1024
              k8s.pod.uid:
                type: keyword
                ignore_above: 1024
      service.node.name:
        type: alias
        path: resource.attributes.service.instance.id
      service.environment:
        type: alias
        path: resource.attributes.deployment.environment
      cloud.service.name:
        type: alias
        path: resource.attributes.cloud.platform
      container.image.tag:
        type: alias
        path: resource.attributes.container.image.tags
      host.architecture:
        type: alias
        path: resource.attributes.host.arch
      process.executable:
        type: alias
        path: resource.attributes.process.executable.path
      service.runtime.name:
        type: alias
        path: resource.attributes.process.runtime.path
      service.runtime.version:
        type: alias
        path: resource.attributes.process.runtime.version
      host.os.name:
        type: alias
        path: resource.attributes.os.name
      host.os.platform:
        type: alias
        path: resource.attributes.os.type
      host.os.full:
        type: alias
        path: resource.attributes.os.description
      host.os.version:
        type: alias
        path: resource.attributes.os.version
      kubernetes.deployment.name:
        type: alias
        path: resource.attributes.k8s.deployment.name
      kubernetes.namespace:
        type: alias
        path: resource.attributes.k8s.namespace.name
      kubernetes.node.name:
        type: alias
        path: resource.attributes.k8s.node.name
      kubernetes.pod.name:
        type: alias
        path: resource.attributes.k8s.pod.name
      kubernetes.pod.uid:
        type: alias
        path: resource.attributes.k8s.pod.uid
# Below is a non-ECS field, ideally we should have this in a separate file
# I'd imagine having 3 files:
# 1) for the fixed mapping for known resource.attributes.* fields that we want to alias
# 2) this file that aliases ECS -> SemConv
# 3) a new file that aliases non-ECS fields the UI uses -> SemConv
# I implemented it, but always run into such errors:
# [2024-08-01T16:01:49,193][ERROR][o.e.x.c.t.IndexTemplateRegistry] [test-cluster-0] error adding index template [semconv-resource-to-ecs@mappings] for [otel] org.elasticsearch.index.mapper.MapperParsingException: Invalid [path] value [resource.attributes.container.image.tags] for field alias [container.image.tag]: an alias must refer to an existing field in the mappings.
# (That error eventually happens for all fields) - tried changing the order of the 3 files - did not help
# So as a workaround for now, I put this here:
      service.language.name:
        type: alias
        path: resource.attributes.telemetry.sdk.language
