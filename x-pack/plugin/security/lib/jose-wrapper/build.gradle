apply plugin: 'elasticsearch.build'

base {
  archivesName = 'elasticsearch-jose-wrapper'
}

dependencies {
  // the actual two libraries we care about
  api "com.nimbusds:oauth2-oidc-sdk:11.10.1"
  api "com.nimbusds:nimbus-jose-jwt:9.37.3"

  // transitive dependencies of oidc
  api "com.nimbusds:lang-tag:1.4.4"
  api "com.sun.mail:jakarta.mail:1.6.3"
  api "net.jcip:jcip-annotations:1.0"
  api "net.minidev:json-smart:2.5.1"
  api "net.minidev:accessors-smart:2.4.2"
  api "org.ow2.asm:asm:8.0.1"

  api project(':server')
}

tasks.named("thirdPartyAudit").configure {
  ignoreMissingClasses(
    // Optional dependency of nimbus-jose-jwt for handling Ed25519 signatures and ECDH with X25519 (RFC 8037)
    'com.google.crypto.tink.subtle.Ed25519Sign',
    'com.google.crypto.tink.subtle.Ed25519Sign$KeyPair',
    'com.google.crypto.tink.subtle.Ed25519Verify',
    'com.google.crypto.tink.subtle.X25519',
    'com.google.crypto.tink.subtle.XChaCha20Poly1305',
//    'com.nimbusds.common.contenttype.ContentType',
//    'com.nimbusds.common.contenttype.ContentType$Parameter',
    'org.bouncycastle.asn1.pkcs.PrivateKeyInfo',
    'org.bouncycastle.asn1.x509.AlgorithmIdentifier',
    'org.bouncycastle.asn1.x509.SubjectPublicKeyInfo',
    'org.bouncycastle.cert.X509CertificateHolder',
    'org.bouncycastle.cert.jcajce.JcaX509CertificateHolder',
    'org.bouncycastle.crypto.InvalidCipherTextException',
    'org.bouncycastle.crypto.engines.AESEngine',
    'org.bouncycastle.crypto.modes.GCMBlockCipher',
    'org.bouncycastle.jcajce.provider.BouncyCastleFipsProvider',
    'org.bouncycastle.jce.provider.BouncyCastleProvider',
    'org.bouncycastle.openssl.PEMKeyPair',
    'org.bouncycastle.openssl.PEMParser',
    'org.bouncycastle.openssl.jcajce.JcaPEMKeyConverter',

    // unchecked
    "com.nimbusds.common.contenttype.ContentType",
    'com.nimbusds.common.contenttype.ContentType$Parameter',
    "jakarta.servlet.ServletRequest",
    "jakarta.servlet.http.HttpServletRequest",
    "jakarta.servlet.http.HttpServletResponse",
    "javax.activation.ActivationDataFlavor",
    "javax.activation.DataContentHandler",
    "javax.activation.DataHandler",
    "javax.activation.DataSource",
    "javax.activation.FileDataSource",
    "javax.activation.FileTypeMap",
    "javax.servlet.ServletRequest",
    "javax.servlet.http.HttpServletRequest",
    "javax.servlet.http.HttpServletResponse",
    "net.shibboleth.utilities.java.support.xml.SerializeSupport",
    "org.bouncycastle.cert.jcajce.JcaX509v3CertificateBuilder",
    "org.bouncycastle.operator.jcajce.JcaContentSignerBuilder",
    "org.cryptomator.siv.SivMode",
    "org.joda.time.DateTime",
    "org.opensaml.core.config.InitializationException",
    "org.opensaml.core.config.InitializationService",
    "org.opensaml.core.xml.XMLObject",
    "org.opensaml.core.xml.XMLObjectBuilder",
    "org.opensaml.core.xml.XMLObjectBuilderFactory",
    "org.opensaml.core.xml.config.XMLObjectProviderRegistrySupport",
    "org.opensaml.core.xml.io.Marshaller",
    "org.opensaml.core.xml.io.MarshallerFactory",
    "org.opensaml.core.xml.io.MarshallingException",
    "org.opensaml.core.xml.io.Unmarshaller",
    "org.opensaml.core.xml.io.UnmarshallerFactory",
    "org.opensaml.core.xml.schema.XSString",
    "org.opensaml.core.xml.schema.impl.XSStringBuilder",
    "org.opensaml.saml.saml2.core.Assertion",
    "org.opensaml.saml.saml2.core.Attribute",
    "org.opensaml.saml.saml2.core.AttributeStatement",
    "org.opensaml.saml.saml2.core.AttributeValue",
    "org.opensaml.saml.saml2.core.Audience",
    "org.opensaml.saml.saml2.core.AudienceRestriction",
    "org.opensaml.saml.saml2.core.AuthnContext",
    "org.opensaml.saml.saml2.core.AuthnContextClassRef",
    "org.opensaml.saml.saml2.core.AuthnStatement",
    "org.opensaml.saml.saml2.core.Conditions",
    "org.opensaml.saml.saml2.core.Issuer",
    "org.opensaml.saml.saml2.core.NameID",
    "org.opensaml.saml.saml2.core.Subject",
    "org.opensaml.saml.saml2.core.SubjectConfirmation",
    "org.opensaml.saml.saml2.core.SubjectConfirmationData",
    "org.opensaml.saml.security.impl.SAMLSignatureProfileValidator",
    "org.opensaml.security.credential.BasicCredential",
    "org.opensaml.security.credential.Credential",
    "org.opensaml.security.credential.UsageType",
    "org.opensaml.xmlsec.signature.Signature",
    "org.opensaml.xmlsec.signature.support.SignatureException",
    "org.opensaml.xmlsec.signature.support.SignatureValidator",
    "org.opensaml.xmlsec.signature.support.Signer",
  )
}
